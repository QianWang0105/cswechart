<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="comle.financing">
	<select id="getfinancingListData" parameterType="java.util.Map" resultType="java.util.Map" >
		select t.key as costType,t.value as costTypeStr
			,t.maintype as mainType,t.maintypedescribe as mainTypeStr
			,st.writeyear as year,sum(st.money) as total
		from t_s_code t 
		 left join t_f_financingwrite st on t.codetype = st.costtype
	       and st.writeyear = '$writeyear$'
		where t.codetype = 'costtype' 
	    group by t.key,t.value,t.maintype,t.maintypedescribe ,st.writeyear
	    order by t.orderby
	</select>
	
	<select id="getflistDetailData" parameterType="java.util.Map" resultType="java.util.Map" >
		select t.*
		from t_f_financingwrite t 
		left join t_s_code st on t.costtype = st.codetype
			and st.codetype = 'costtype' 
		where t.writeyear = '#year#'
	</select>
	
	<insert id="financingWriteInsert" parameterType="com.lion.echart.financing.entity.FinancingWriteEntity">
           insert into t_f_financingwrite(payfordate, costtype, maintype, contractid, 
           	subofficeid, money, operdate, operuser, writeyear, writemonth, cashierno, voucherno) 
               values(str_to_date(#{payfordateStr},'%Y-%m-%d %H'), #{costtype}, #{maintype}, #{contractid}, 
            #{subofficeid}, #{money}, now(), #{operuser}, #{writeyear}, #{writemonth}, #{cashierno}, #{voucherno})
   	</insert>
	
	<update id="financingWriteUpdate" parameterType="com.lion.echart.financing.entity.FinancingWriteEntity">
    	udpate t_f_financingwrite
    	set id = #id#
    	where id = #id#
    </update>
</mapper>